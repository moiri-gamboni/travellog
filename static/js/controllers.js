// Generated by CoffeeScript 1.6.3
(function() {
  "use strict";
  var ctrl;

  ctrl = angular.module("mainModule.controllers", []);

  ctrl.controller("mainCtrl", [
    '$http', '$scope', '$rootScope', '$timeout', 'Map', function($http, $scope, $rootScope, $timeout, Map) {
      var switchLogs;
      Map.initMap();
      switchLogs = true;
      $scope.dropPins = function() {
        var dropPin, i, log, logId, _ref;
        dropPin = function(log) {
          return function() {
            return placeMarkerMiniMap(log);
          };
        };
        i = 0;
        _ref = Map.data.logs;
        for (logId in _ref) {
          log = _ref[logId];
          $timeout(dropPin(log), 200 * i);
          i++;
        }
        return $timeout(function() {
          console.log($scope.log.id);
          return changeLocation($scope.log.id);
        }, 2800);
      };
      $rootScope.$on('animation-done', function() {
        console.log("firing");
        return switchLogs = !switchLogs;
      });
      $rootScope.$on('gotFirstLog', function() {
        $scope.log = Map.getCurrentLog();
        return $scope.dropPins();
      });
      $scope.getLog = function() {
        return $scope.log = Map.getCurrentLog();
      };
      return $scope.move = function(direction) {
        if (switchLogs) {
          $scope.otherLog = Map.move(direction);
          return changeLocation($scope.otherLog.id);
        } else {
          $scope.log = Map.move(direction);
          return changeLocation($scope.log.id);
        }
      };
    }
  ]);

  ctrl.controller("MyFilesController", [
    '$http', '$scope', '$rootScope', 'User', function($http, $scope, $rootScope, User) {
      var _this = this;
      $scope.myfiles = {
        "title": "empty"
      };
      $scope.selectedFile = null;
      $scope.addMapSelected = false;
      $rootScope.$on('loggedIn', function(event, resp) {
        User = resp;
        $scope.$apply(function() {
          return $scope.loggedIn = true;
        });
        return retrieveAllFiles(function(resp) {
          return $scope.$apply(function() {
            return $scope.myfiles = resp;
          });
        });
      });
      $rootScope.$on('addMapSelected', function() {
        return $scope.$apply(function() {
          return $scope.addMapSelected = true;
        });
      });
      $scope.isSelected = function(file) {
        return file === $scope.selectedFile;
      };
      $scope.selectFile = function(file) {
        console.log(User);
        return $scope.selectedFile = file;
      };
      $scope.canSubmit = function() {
        return $scope.addMapSelected && ($scope.selectedFile != null);
      };
      return $scope.upload = function() {};
    }
  ]);

}).call(this);
